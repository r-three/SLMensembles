Sliding Window Attention is enabled but not implemented for `sdpa`; unexpected results may be encountered.

==================================================
Starting Round 0 at: 2025-05-25 22:27:47
==================================================
Round '0' model stored in: /scratch/ssd004/scratch/klambert/slm_ensembles/boosted_distillation_1.5B_teacher_average_fixed_logging/2025-05-25/run_4/round_0
Detected kernel version 5.4.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
                                                                                                                                                                                                                                                                               
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 244/244 [00:51<00:00,  4.89it/s]
{'eval_loss': 1.4327716827392578, 'eval_runtime': 51.2201, 'eval_samples_per_second': 37.993, 'eval_steps_per_second': 4.764, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 1): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.4005050659179688, 'eval_runtime': 51.6371, 'eval_samples_per_second': 37.686, 'eval_steps_per_second': 4.725, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 2): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.387000560760498, 'eval_runtime': 51.6745, 'eval_samples_per_second': 37.659, 'eval_steps_per_second': 4.722, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 3): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3825445175170898, 'eval_runtime': 51.679, 'eval_samples_per_second': 37.656, 'eval_steps_per_second': 4.721, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 4): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3800009489059448, 'eval_runtime': 51.5891, 'eval_samples_per_second': 37.721, 'eval_steps_per_second': 4.73, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 5): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3801780939102173, 'eval_runtime': 51.5776, 'eval_samples_per_second': 37.73, 'eval_steps_per_second': 4.731, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 6): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.379472017288208, 'eval_runtime': 51.5559, 'eval_samples_per_second': 37.745, 'eval_steps_per_second': 4.733, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 7): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.380924105644226, 'eval_runtime': 51.5485, 'eval_samples_per_second': 37.751, 'eval_steps_per_second': 4.733, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 8): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.379865288734436, 'eval_runtime': 51.5513, 'eval_samples_per_second': 37.749, 'eval_steps_per_second': 4.733, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 9): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'loss': 0.3378, 'grad_norm': 7.21875, 'learning_rate': 2.0000000000000003e-06, 'epoch': 0.0}
{'eval_loss': 1.3808362483978271, 'eval_runtime': 51.5469, 'eval_samples_per_second': 37.752, 'eval_steps_per_second': 4.734, 'epoch': 0.0}


Original Eval Metrics Keys (Round 0, Step 10): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'train_runtime': 590.3884, 'train_samples_per_second': 0.034, 'train_steps_per_second': 0.017, 'train_loss': 0.33780362606048586, 'epoch': 0.0}

-------------------------
Student evaluation for 0: 1.3195983171463013
Ensemble evaluation for 0: 1.3195983171463013
Teacher evaluation for 0: 1.0332053899765015
-------------------------
==================================================
Ending Round 0 at: 2025-05-25 22:37:49
Completed in: 10m 2s
Total training time: 10m 11s
==================================================


==================================================
Starting Round 1 at: 2025-05-25 22:37:50
==================================================
Round '1' model stored in: /scratch/ssd004/scratch/klambert/slm_ensembles/boosted_distillation_1.5B_teacher_average_fixed_logging/2025-05-25/run_4/round_1
                                                                                                                                                                                                                                                                               
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 244/244 [01:41<00:00,  2.66it/s]
{'eval_loss': 1.376921534538269, 'eval_runtime': 102.2506, 'eval_samples_per_second': 19.032, 'eval_steps_per_second': 2.386, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 1): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.37186598777771, 'eval_runtime': 102.3452, 'eval_samples_per_second': 19.014, 'eval_steps_per_second': 2.384, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 2): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.373160719871521, 'eval_runtime': 102.2284, 'eval_samples_per_second': 19.036, 'eval_steps_per_second': 2.387, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 3): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3735337257385254, 'eval_runtime': 102.1785, 'eval_samples_per_second': 19.045, 'eval_steps_per_second': 2.388, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 4): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3739303350448608, 'eval_runtime': 101.969, 'eval_samples_per_second': 19.084, 'eval_steps_per_second': 2.393, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 5): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.37468683719635, 'eval_runtime': 101.9972, 'eval_samples_per_second': 19.079, 'eval_steps_per_second': 2.392, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 6): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.374779462814331, 'eval_runtime': 101.9926, 'eval_samples_per_second': 19.08, 'eval_steps_per_second': 2.392, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 7): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3747671842575073, 'eval_runtime': 102.0227, 'eval_samples_per_second': 19.074, 'eval_steps_per_second': 2.392, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 8): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.374815583229065, 'eval_runtime': 101.9808, 'eval_samples_per_second': 19.082, 'eval_steps_per_second': 2.393, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 9): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'loss': 0.3456, 'grad_norm': 3.203125, 'learning_rate': 2.0000000000000003e-06, 'epoch': 0.0}
{'eval_loss': 1.3746750354766846, 'eval_runtime': 101.9546, 'eval_samples_per_second': 19.087, 'eval_steps_per_second': 2.393, 'epoch': 0.0}


Original Eval Metrics Keys (Round 1, Step 10): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'train_runtime': 1096.8597, 'train_samples_per_second': 0.018, 'train_steps_per_second': 0.009, 'train_loss': 0.34557790756225587, 'epoch': 0.0}

-------------------------
Student evaluation for 1: 1.318422555923462
Ensemble evaluation for 1: 1.3150919675827026
Teacher evaluation for 1: 1.0332053899765015
-------------------------
==================================================
Ending Round 1 at: 2025-05-25 22:56:19
Completed in: 18m 29s
Total training time: 28m 41s
==================================================


==================================================
Starting Round 2 at: 2025-05-25 22:56:19
==================================================
Round '2' model stored in: /scratch/ssd004/scratch/klambert/slm_ensembles/boosted_distillation_1.5B_teacher_average_fixed_logging/2025-05-25/run_4/round_2
                                                                                                                                                                                                                                                                               
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 244/244 [02:21<00:00,  1.97it/s]
{'eval_loss': 1.3768033981323242, 'eval_runtime': 142.0479, 'eval_samples_per_second': 13.7, 'eval_steps_per_second': 1.718, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 1): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3738523721694946, 'eval_runtime': 142.0393, 'eval_samples_per_second': 13.7, 'eval_steps_per_second': 1.718, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 2): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3720594644546509, 'eval_runtime': 141.9201, 'eval_samples_per_second': 13.712, 'eval_steps_per_second': 1.719, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 3): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3721728324890137, 'eval_runtime': 141.9003, 'eval_samples_per_second': 13.714, 'eval_steps_per_second': 1.72, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 4): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3727713823318481, 'eval_runtime': 141.7661, 'eval_samples_per_second': 13.727, 'eval_steps_per_second': 1.721, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 5): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.373642086982727, 'eval_runtime': 141.6415, 'eval_samples_per_second': 13.739, 'eval_steps_per_second': 1.723, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 6): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.373396873474121, 'eval_runtime': 141.5935, 'eval_samples_per_second': 13.744, 'eval_steps_per_second': 1.723, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 7): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3737378120422363, 'eval_runtime': 141.6243, 'eval_samples_per_second': 13.741, 'eval_steps_per_second': 1.723, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 8): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.374170184135437, 'eval_runtime': 141.5904, 'eval_samples_per_second': 13.744, 'eval_steps_per_second': 1.723, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 9): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'loss': 0.2674, 'grad_norm': 1.8203125, 'learning_rate': 2.0000000000000003e-06, 'epoch': 0.0}
{'eval_loss': 1.3738402128219604, 'eval_runtime': 141.5791, 'eval_samples_per_second': 13.745, 'eval_steps_per_second': 1.723, 'epoch': 0.0}


Original Eval Metrics Keys (Round 2, Step 10): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'train_runtime': 1492.163, 'train_samples_per_second': 0.013, 'train_steps_per_second': 0.007, 'train_loss': 0.2674454689025879, 'epoch': 0.0}

-------------------------
Student evaluation for 2: 1.3327620029449463
Ensemble evaluation for 2: 1.3146363496780396
Teacher evaluation for 2: 1.0332053899765015
-------------------------
==================================================
Ending Round 2 at: 2025-05-25 23:21:23
Completed in: 25m 4s
Total training time: 53m 45s
==================================================


==================================================
Starting Round 3 at: 2025-05-25 23:21:24
==================================================
Round '3' model stored in: /scratch/ssd004/scratch/klambert/slm_ensembles/boosted_distillation_1.5B_teacher_average_fixed_logging/2025-05-25/run_4/round_3
 40%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                                                            | 4/10 [09:24<16:14, 162.38s/it]Traceback (most recent call last):
  File "/h/klambert/slm_ensembles/train.py", line 332, in <module>████████████████████████████████████▉                                                                                                                                      | 103/244 [01:16<01:45,  1.34it/s]
{'eval_loss': 1.370850682258606, 'eval_runtime': 181.8376, 'eval_samples_per_second': 10.702, 'eval_steps_per_second': 1.342, 'epoch': 0.0}


Original Eval Metrics Keys (Round 3, Step 1): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.3719571828842163, 'eval_runtime': 181.667, 'eval_samples_per_second': 10.712, 'eval_steps_per_second': 1.343, 'epoch': 0.0}


Original Eval Metrics Keys (Round 3, Step 2): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']


{'eval_loss': 1.373506784439087, 'eval_runtime': 181.4925, 'eval_samples_per_second': 10.722, 'eval_steps_per_second': 1.344, 'epoch': 0.0}


Original Eval Metrics Keys (Round 3, Step 3): ['eval_loss', 'eval_runtime', 'eval_samples_per_second', 'eval_steps_per_second', 'epoch']
    main()
  File "/h/klambert/slm_ensembles/train.py", line 273, in main
    trainer.train()
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/trainer.py", line 2245, in train
    return inner_training_loop(
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/trainer.py", line 2627, in _inner_training_loop
    self._maybe_log_save_evaluate(
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/trainer.py", line 3096, in _maybe_log_save_evaluate
    metrics = self._evaluate(trial, ignore_keys_for_eval)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/trainer.py", line 3045, in _evaluate
    metrics = self.evaluate(ignore_keys=ignore_keys_for_eval)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/trainer.py", line 4154, in evaluate
    output = eval_loop(
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/trainer.py", line 4348, in evaluation_loop
    losses, logits, labels = self.prediction_step(model, inputs, prediction_loss_only, ignore_keys=ignore_keys)
  File "/h/klambert/slm_ensembles/train.py", line 142, in prediction_step
    ensemble_logits = ensemble_model(input_ids=input_ids, attention_mask=attention_mask).logits.detach()
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/fs01/home/klambert/slm_ensembles/ensemble.py", line 47, in forward
    outputs = model(input_ids.to(device), attention_mask=attention_mask.to(device), **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/utils/generic.py", line 965, in wrapper
    output = func(self, *args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/utils/deprecation.py", line 172, in wrapped_func
    return func(*args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/models/qwen2/modeling_qwen2.py", line 823, in forward
    outputs: BaseModelOutputWithPast = self.model(
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/utils/generic.py", line 965, in wrapper
    output = func(self, *args, **kwargs)
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/models/qwen2/modeling_qwen2.py", line 519, in forward
    causal_mask = self._update_causal_mask(
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/models/qwen2/modeling_qwen2.py", line 613, in _update_causal_mask
    if AttentionMaskConverter._ignore_causal_mask_sdpa(
  File "/scratch/ssd004/scratch/klambert/slm_ensembles/venv/lib/python3.10/site-packages/transformers/modeling_attn_mask_utils.py", line 288, in _ignore_causal_mask_sdpa
    elif not is_tracing and torch.all(attention_mask == 1):
KeyboardInterrupt
