# Distillation Project Setup Guide

The codes in this directory are developed based on the Distilkit's implementation of logit-based distillation: [link](https://github.com/arcee-ai/DistillKit)

## Prerequisites

Before starting, ensure you have access to a system with CUDA support and the required modules.

## Quick Start

### Step 1: Load Required Modules

Load the necessary system modules by running the following commands:

```bash
module load cuda/12.6
module load gcc arrow/19.0.1 python/3.11
```

> **Note**: These modules must be loaded in your current session before proceeding to the next steps.

### Step 2: Environment Setup

Create a virtual environment and install required dependencies:

```bash
./setup.sh
```

This script will install all necessary libraries and dependencies

## ⚙️ Configuration

### Step 3: Configure Distillation Parameters

Update the distillation settings in the configuration file:

```bash
vim distl_logits.py  # or use your preferred editor
```

**Key configurations to review:**
- Wandb project name
- Dataset name
- Number of training samples
- Number of epochs
- HuggingFace path of the teacher and student models

### Step 4: Configure Runtime Environment  

Update the execution settings in the run script:

```bash
vim run.sh  # or use your preferred editor
```

**Important settings to configure:**
- **Directory paths**: Update input/output file directories
- **GPU allocation**: Set the number of GPUs and memory requirements
- **Job parameters**: Configure resource requests

## 🏃Execution

### Step 5: Launch Distillation Job

Submit the distillation job to the scheduler:

```bash
sbatch run.sh
```

## Project Structure

```
project/
├── setup.sh              # Environment setup script
├── run.sh                 # Job submission script  
├── distl_logits.py       # Distillation configuration
└── README.md             # This file
```


## 🔧 Troubleshooting

### Common Issues

- **Module loading errors**: Ensure you're on a compute node with access to the specified modules
- **Permission errors**: Make sure `setup.sh` and `run.sh` have execute permissions (`chmod +x`)
- **GPU allocation**: Verify your account has access to the requested GPU resources

### Getting Help

If you encounter issues:
1. Check the job output logs generated by `sbatch`
2. Verify module availability with `module avail`
3. Confirm GPU resources with `sinfo` or similar cluster commands

## 📝 Notes

- The setup process creates an isolated Python environment to avoid conflicts
- Make sure to load the required modules each time you start a new session
- Monitor your job status with `squeue` after submission
